<?php
// -------------------------------------------
// PHP PROXY EXECUTION (runs only if ?url= is set)
// -------------------------------------------
if (isset($_GET['url'])) {

    $allowed_domains = [
        "example.com",
        "api.example.com"
    ];

    $url = $_GET['url'];

    // Block unsafe protocols
    if (preg_match('/^(file|php|data|glob|phar):/i', $url)) {
        http_response_code(400);
        echo "Unsafe protocol blocked.";
        exit;
    }

    $parsed = parse_url($url);
    $domain = $parsed['host'] ?? '';

    if (!in_array($domain, $allowed_domains)) {
        http_response_code(403);
        echo "Domain is not allowed.";
        exit;
    }

    // cURL proxy
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
    $response = curl_exec($ch);

    $content_type = curl_getinfo($ch, CURLINFO_CONTENT_TYPE);
    curl_close($ch);

    if ($content_type) header("Content-Type: ".$content_type);

    echo $response;
    exit; // Stop HTML from rendering
}
?>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Proxy Search</title>

<style>
    .search-box {
        max-width: 450px;
        margin: 40px auto;
        display: flex;
        border: 2px solid #444;
        border-radius: 30px;
        padding: 6px 15px;
        background: #fff;
    }
    .search-box input {
        flex: 1;
        border: none;
        outline: none;
        font-size: 16px;
    }
    .search-box button {
        background: #0078ff;
        color: #fff;
        border: none;
        padding: 8px 18px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
    }
    .search-box button:hover {
        background: #005ecc;
    }
</style>
</head>

<body>

<h2 style="text-align:center;">PHP Proxy Search</h2>

<form method="GET">
    <div class="search-box">
        <input type="text" name="url" placeholder="Enter URL to proxy..." required>
        <button type="submit">Go</button>
    </div>
</form>

</body>
</html>
